<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - CO2eq</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            color: white;
        }
        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #212529; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug Console - CO2eq</h1>
        
        <div class="test-section">
            <h3>1. Status da Autentica√ß√£o</h3>
            <div id="authStatus"></div>
            <button class="btn btn-primary" onclick="checkAuth()">Verificar Status</button>
        </div>

        <div class="test-section">
            <h3>2. Dados Armazenados</h3>
            <div id="storedData"></div>
            <button class="btn btn-primary" onclick="showStoredData()">Mostrar Dados</button>
        </div>

        <div class="test-section">
            <h3>3. Teste de Login Simulado</h3>
            <div id="loginTest"></div>
            <button class="btn btn-success" onclick="testSimulateLogin()">Testar Login Simulado</button>
        </div>

        <div class="test-section">
            <h3>4. Teste de Prote√ß√£o</h3>
            <div id="protectionTest"></div>
            <button class="btn btn-warning" onclick="testProtection()">Testar Acesso Direto √† Calculadora</button>
        </div>

        <div class="test-section">
            <h3>5. A√ß√µes de Limpeza</h3>
            <button class="btn btn-danger" onclick="clearAllData()">Limpar Todos os Dados</button>
            <button class="btn btn-danger" onclick="forceLogout()">For√ßar Logout</button>
        </div>

        <div class="test-section">
            <h3>6. Navega√ß√£o</h3>
            <button class="btn btn-primary" onclick="goToLogin()">Ir para Login</button>
            <button class="btn btn-primary" onclick="goToCalculator()">Ir para Calculadora</button>
        </div>

        <div class="test-section">
            <h3>7. Log de Console</h3>
            <div id="consoleLog"></div>
            <button class="btn btn-primary" onclick="clearConsoleLog()">Limpar Log</button>
        </div>
    </div>

    <script src="script_js.js"></script>
    <script>
        let consoleMessages = [];

        // Interceptar console.log
        const originalLog = console.log;
        console.log = function(...args) {
            consoleMessages.push(args.join(' '));
            updateConsoleLog();
            originalLog.apply(console, arguments);
        };

        function updateConsoleLog() {
            const logDiv = document.getElementById('consoleLog');
            logDiv.innerHTML = '<pre>' + consoleMessages.slice(-10).join('\n') + '</pre>';
        }

        function clearConsoleLog() {
            consoleMessages = [];
            updateConsoleLog();
        }

        function checkAuth() {
            const token = localStorage.getItem('linkedin_access_token');
            const profile = localStorage.getItem('user_profile');
            
            let html = '';
            if (token) {
                html += '<div class="status success">‚úÖ Token encontrado: ' + token.substring(0, 20) + '...</div>';
            } else {
                html += '<div class="status error">‚ùå Token n√£o encontrado</div>';
            }
            
            if (profile) {
                const profileData = JSON.parse(profile);
                html += '<div class="status success">‚úÖ Perfil encontrado: ' + profileData.firstName + ' ' + profileData.lastName + '</div>';
            } else {
                html += '<div class="status error">‚ùå Perfil n√£o encontrado</div>';
            }
            
            document.getElementById('authStatus').innerHTML = html;
            console.log('Status de autentica√ß√£o verificado');
        }

        function showStoredData() {
            const data = {
                token: localStorage.getItem('linkedin_access_token'),
                profile: localStorage.getItem('user_profile'),
                state: localStorage.getItem('linkedin_state'),
                allKeys: Object.keys(localStorage)
            };
            
            document.getElementById('storedData').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            console.log('Dados armazenados mostrados');
        }

        function testSimulateLogin() {
            try {
                console.log('Iniciando teste de login simulado...');
                
                // Verificar se fun√ß√£o existe
                if (typeof simulateLogin === 'function') {
                    document.getElementById('loginTest').innerHTML = '<div class="status info">üîÑ Executando login simulado...</div>';
                    simulateLogin();
                } else {
                    document.getElementById('loginTest').innerHTML = '<div class="status error">‚ùå Fun√ß√£o simulateLogin n√£o encontrada</div>';
                }
            } catch (error) {
                document.getElementById('loginTest').innerHTML = '<div class="status error">‚ùå Erro: ' + error.message + '</div>';
                console.error('Erro no teste de login:', error);
            }
        }

        function testProtection() {
            console.log('Testando prote√ß√£o de acesso...');
            
            // Simular tentativa de acesso sem autentica√ß√£o
            localStorage.removeItem('linkedin_access_token');
            
            setTimeout(() => {
                if (typeof checkAuthentication === 'function') {
                    const result = checkAuthentication();
                    if (result) {
                        document.getElementById('protectionTest').innerHTML = '<div class="status error">‚ùå Prote√ß√£o falhou - acesso permitido sem token</div>';
                    } else {
                        document.getElementById('protectionTest').innerHTML = '<div class="status success">‚úÖ Prote√ß√£o funcionando - acesso negado sem token</div>';
                    }
                } else {
                    document.getElementById('protectionTest').innerHTML = '<div class="status error">‚ùå Fun√ß√£o checkAuthentication n√£o encontrada</div>';
                }
            }, 100);
        }

        function clearAllData() {
            localStorage.clear();
            console.log('Todos os dados do localStorage limpos');
            alert('Dados limpos! Recarregue a p√°gina para testar novamente.');
        }

        function forceLogout() {
            if (typeof logout === 'function') {
                logout();
            } else {
                localStorage.clear();
                window.location.href = 'login_html.html';
            }
        }

        function goToLogin() {
            window.location.href = 'login_html.html';
        }

        function goToCalculator() {
            window.location.href = 'index_html.html';
        }

        // Auto-executar verifica√ß√µes na carga da p√°gina
        window.onload = function() {
            console.log('Debug page carregada');
            checkAuth();
            showStoredData();
        };
    </script>
</body>
</html>